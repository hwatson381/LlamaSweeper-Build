(function(){"use strict";class xe{constructor(e,t,o,i,n,l){this.premiumsMap=new Map,this.xReverse=e,this.yReverse=t,this.xySwap=o,this.width=i,this.height=n,this.excludeNegativePremiums=l}addPremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToOrder(e,t),n=this.premiumsMap.get(o);if(!Array.isArray(n))this.premiumsMap.set(o,[i]);else{let l=this.sortedIndex(n,i);n.splice(l,0,i)}}lazyAddPremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToOrder(e,t),n=this.premiumsMap.get(o);Array.isArray(n)?n.push(i):this.premiumsMap.set(o,[i])}sortAfterLazyAdd(){for(let e of this.premiumsMap.values())e.sort((t,o)=>t-o)}removePremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToOrder(e,t),n=this.premiumsMap.get(o),l=this.sortedIndex(n,i);if(n[l]!==i)throw new Error("Order not found in premiums array?");n.splice(l,1),n.length===0&&this.premiumsMap.delete(o)}updatePremium(e,t,o,i){o!==i&&(this.removePremium(e,t,o),this.addPremium(e,t,i))}getHighestPremium(){if(this.premiumsMap.size===0){if(this.excludeNegativePremiums)return{x:"not stored",y:"not stored",premium:-1};throw new Error("Empty map")}const e=Math.max.apply(null,[...this.premiumsMap.keys()]);let t=this.premiumsMap.get(e)[0],{x:o,y:i}=this.orderToXy(t);return{x:o,y:i,premium:e}}xyToOrder(e,t){let o=this.xReverse?this.width-1-e:e,i=this.yReverse?this.height-1-t:t;return this.xySwap?i+this.height*o:o+this.width*i}orderToXy(e){let t,o;this.xySwap?(o=e%this.height,t=Math.floor(e/this.height)):(t=e%this.width,o=Math.floor(e/this.width));let i=this.xReverse?this.width-1-t:t,n=this.yReverse?this.height-1-o:o;return{x:i,y:n}}sortedIndex(e,t){for(var o=0,i=e.length;o<i;){var n=o+i>>>1;e[n]<t?o=n+1:i=n}return o}}class ie{static createWomBoardDataObject(e,t,o){const i=e.length,n=e[0].length,{numbersArray:l,openingLabels:u,preprocessedOpenings:r}=t;let f=[],s=[],a=[],h=[];for(let d=0;d<i;d++)for(let p=0;p<n;p++){let y=l[d][p]==="x"?10:l[d][p];f.push(y),s.push(0),a.push(0),h.push(!1)}for(let[d,p]of r.entries()){for(let y of p.zeros){let C=y.y+y.x*n;s[C]=d}for(let y of p.edges){let C=y.y+y.x*n;s[C]===0?(s[C]=d,h[C]=!0):a[C]=d}}let c={f:[],g:s,g2:a,o:[],t:f};return o&&(c.womOpeningEdgesArray=h),c}static c215(e,t,o,i,n){if(typeof window<"u"&&!("Uint8Array"in window))return{total:0,clicks:[]};let l=o*i-n,u=0,r=[],f=!1,s={t:new Uint8Array(o*i),f:new Uint8Array(o*i),o:new Uint8Array(o*i),g:new Uint8Array(o*i),g2:new Uint8Array(o*i),p:new Int8Array(o*i)};for(let a=0;a<o*i;a++)s.t[a]=t.t[a],s.f[a]=0,s.o[a]=0,s.g[a]=t.g[a],s.g2[a]=t.g2[a],s.p[a]=0,s.t[a]==11&&(s.t[a]=10);if(t.womOpeningEdgesArray&&(s.womOpeningEdgesArray=t.womOpeningEdgesArray.slice(0)),e){let a=[];for(let h=0;h<o;h++)for(let c=0;c<i;c++)s.g[h*i+c]&&(!a.includes(s.g[h*i+c])&&s.t[h*i+c]===0&&(a.push(s.g[h*i+c]),r.push({type:"left",x:h,y:c})),s.o[h*i+c]=1,l--),s.g[h*i+c]>u&&(u=s.g[h*i+c]);f=!0}for(let a=0;a<o;a++)for(let h=0;h<i;h++)s.p[a*i+h]=this.c216(a,h,o,i,s);for(;l>0;){let a=this.g250(e,o,i,s);if(a.premiumBestIndexes.length>0&&a.premiumBestValue>=0){let h=a.premiumBestIndexes[0];if(a.premiumBestIndexes.length>1){let y=-1;for(let C=0;C<a.premiumBestIndexes.length;C++){let v=a.premiumBestIndexes[C]/i|0,O=a.premiumBestIndexes[C]%i,w={t:s.t,o:s.o.slice(0),f:s.f.slice(0),g:s.g,g2:s.g2,p:s.p.slice(0)};this.p104(v,O,o,i,w);let F=this.g250(e,o,i,w),g=F.premiumBestValue*1e3+F.premiumBestIndexes.length;g>y&&(h=a.premiumBestIndexes[C],y=g)}}let c=h/i|0,d=h%i,p=this.p104(c,d,o,i,s);u+=p.zini,l+=p.needToOpenCount,r=r.concat(p.clicks)}else{let h=!1;if(!f){for(let c=0;c<o&&!h;c++)for(let d=0;d<i&&!h;d++)!s.o[c*i+d]&&s.t[c*i+d]==0&&(l-=this.o68(c,d,o,i,s),u++,h=!0,r.push({type:"left",x:c,y:d}));h||(f=!0)}if(f){h=!1;for(let c=0;c<o&&!h;c++)for(let d=0;d<i&&!h;d++)s.t[c*i+d]!=10&&!s.o[c*i+d]&&!(s.g2[c*i+d]&&s.t[c*i+d]>0)&&(l-=this.o68(c,d,o,i,s),u++,h=!0,r.push({type:"left",x:c,y:d}));if(!h)return{total:u,clicks:r}}}}return{total:u,clicks:r}}static g250(e,t,o,i){let n={premiumBestIndexes:[],premiumBestValue:-100};for(let l=0;l<t*o;l++)e&&!i.o[l]||(i.p[l]>n.premiumBestValue?(n.premiumBestIndexes=[l],n.premiumBestValue=i.p[l]):i.p[l]==n.premiumBestValue&&n.premiumBestIndexes.push(l));return n}static p104(e,t,o,i,n){let l={needToOpenCount:0,zini:0,clicks:[]};return n.o[e*i+t]||(l.needToOpenCount-=this.o68(e,t,o,i,n),l.zini++,l.clicks.push({type:"left",x:e,y:t})),l.zini++,e-1>=0&&t-1>=0&&(n.t[(e-1)*i+(t-1)]==10&&!n.f[(e-1)*i+(t-1)]&&(this.m108(e-1,t-1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e-1,y:t-1})),n.t[(e-1)*i+(t-1)]!=10&&!n.o[(e-1)*i+(t-1)]&&(l.needToOpenCount-=this.o68(e-1,t-1,o,i,n))),t-1>=0&&(n.t[e*i+(t-1)]==10&&!n.f[e*i+(t-1)]&&(this.m108(e,t-1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e,y:t-1})),n.t[e*i+(t-1)]!=10&&!n.o[e*i+(t-1)]&&(l.needToOpenCount-=this.o68(e,t-1,o,i,n))),e+1<o&&t-1>=0&&(n.t[(e+1)*i+(t-1)]==10&&!n.f[(e+1)*i+(t-1)]&&(this.m108(e+1,t-1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e+1,y:t-1})),n.t[(e+1)*i+(t-1)]!=10&&!n.o[(e+1)*i+(t-1)]&&(l.needToOpenCount-=this.o68(e+1,t-1,o,i,n))),e-1>=0&&(n.t[(e-1)*i+t]==10&&!n.f[(e-1)*i+t]&&(this.m108(e-1,t,o,i,n),l.zini++,l.clicks.push({type:"right",x:e-1,y:t})),n.t[(e-1)*i+t]!=10&&!n.o[(e-1)*i+t]&&(l.needToOpenCount-=this.o68(e-1,t,o,i,n))),e+1<o&&(n.t[(e+1)*i+t]==10&&!n.f[(e+1)*i+t]&&(this.m108(e+1,t,o,i,n),l.zini++,l.clicks.push({type:"right",x:e+1,y:t})),n.t[(e+1)*i+t]!=10&&!n.o[(e+1)*i+t]&&(l.needToOpenCount-=this.o68(e+1,t,o,i,n))),e-1>=0&&t+1<i&&(n.t[(e-1)*i+(t+1)]==10&&!n.f[(e-1)*i+(t+1)]&&(this.m108(e-1,t+1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e-1,y:t+1})),n.t[(e-1)*i+(t+1)]!=10&&!n.o[(e-1)*i+(t+1)]&&(l.needToOpenCount-=this.o68(e-1,t+1,o,i,n))),t+1<i&&(n.t[e*i+(t+1)]==10&&!n.f[e*i+(t+1)]&&(this.m108(e,t+1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e,y:t+1})),n.t[e*i+(t+1)]!=10&&!n.o[e*i+(t+1)]&&(l.needToOpenCount-=this.o68(e,t+1,o,i,n))),e+1<o&&t+1<i&&(n.t[(e+1)*i+(t+1)]==10&&!n.f[(e+1)*i+(t+1)]&&(this.m108(e+1,t+1,o,i,n),l.zini++,l.clicks.push({type:"right",x:e+1,y:t+1})),n.t[(e+1)*i+(t+1)]!=10&&!n.o[(e+1)*i+(t+1)]&&(l.needToOpenCount-=this.o68(e+1,t+1,o,i,n))),l.clicks.push({type:"chord",x:e,y:t}),l}static c216(e,t,o,i,n){if(n.t[e*i+t]==0||n.t[e*i+t]==10)return-100;let l=0;return n.o[e*i+t]||(l-=1),l-=1,n.g[e*i+t]||(l+=1),e-1>=0&&t-1>=0&&(n.t[(e-1)*i+(t-1)]==10?n.f[(e-1)*i+(t-1)]||l--:!n.o[(e-1)*i+(t-1)]&&!n.g[(e-1)*i+(t-1)]&&l++),t-1>=0&&(n.t[e*i+(t-1)]==10?n.f[e*i+(t-1)]||l--:!n.o[e*i+(t-1)]&&!n.g[e*i+(t-1)]&&l++),e+1<o&&t-1>=0&&(n.t[(e+1)*i+(t-1)]==10?n.f[(e+1)*i+(t-1)]||l--:!n.o[(e+1)*i+(t-1)]&&!n.g[(e+1)*i+(t-1)]&&l++),e-1>=0&&(n.t[(e-1)*i+t]==10?n.f[(e-1)*i+t]||l--:!n.o[(e-1)*i+t]&&!n.g[(e-1)*i+t]&&l++),e+1<o&&(n.t[(e+1)*i+t]==10?n.f[(e+1)*i+t]||l--:!n.o[(e+1)*i+t]&&!n.g[(e+1)*i+t]&&l++),e-1>=0&&t+1<i&&(n.t[(e-1)*i+(t+1)]==10?n.f[(e-1)*i+(t+1)]||l--:!n.o[(e-1)*i+(t+1)]&&!n.g[(e-1)*i+(t+1)]&&l++),t+1<i&&(n.t[e*i+(t+1)]==10?n.f[e*i+(t+1)]||l--:!n.o[e*i+(t+1)]&&!n.g[e*i+(t+1)]&&l++),e+1<o&&t+1<i&&(n.t[(e+1)*i+(t+1)]==10?n.f[(e+1)*i+(t+1)]||l--:!n.o[(e+1)*i+(t+1)]&&!n.g[(e+1)*i+(t+1)]&&l++),n.womOpeningEdgesArray?l+=this.countUnopenedOpeningsTouchingCell(e,t,o,i,n):n.g2[e*i+t]&&(e-1>=0&&t-1>=0&&n.t[(e-1)*i+(t-1)]==0&&!n.o[(e-1)*i+(t-1)]||t-1>=0&&n.t[e*i+(t-1)]==0&&!n.o[e*i+(t-1)]||e+1<o&&t-1>=0&&n.t[(e+1)*i+(t-1)]==0&&!n.o[(e+1)*i+(t-1)]||e-1>=0&&n.t[(e-1)*i+t]==0&&!n.o[(e-1)*i+t]||e+1<o&&n.t[(e+1)*i+t]==0&&!n.o[(e+1)*i+t]||e-1>=0&&t+1<i&&n.t[(e-1)*i+(t+1)]==0&&!n.o[(e-1)*i+(t+1)]||t+1<i&&n.t[e*i+(t+1)]==0&&!n.o[e*i+(t+1)]||e+1<o&&t+1<i&&n.t[(e+1)*i+(t+1)]==0&&!n.o[(e+1)*i+(t+1)])&&l++,l}static countUnopenedOpeningsTouchingCell(e,t,o,i,n){if(!n.womOpeningEdgesArray)throw new Error("womOpeningEdgesArray undefined, but countOpeningsTouchingCell was called");if(n.womOpeningEdgesArray[e*i+t]===!1)return 0;let l=[{x:e-1,y:t-1},{x:e-1,y:t},{x:e-1,y:t+1},{x:e,y:t-1},{x:e,y:t+1},{x:e+1,y:t-1},{x:e+1,y:t},{x:e+1,y:t+1}];l=l.filter(r=>r.x>=0&&r.x<o&&r.y>=0&&r.y<i);let u=[];for(let r of l)if(!n.o[r.x*i+r.y]&&n.t[r.x*i+r.y]===0){let f=n.g[r.x*i+r.y];u.includes(f)||u.push(f)}return u.length}static o68(e,t,o,i,n){let l=1;if(n.o[e*i+t]=1,n.t[e*i+t]==0){for(let u=0;u<o;u++)for(let r=0;r<i;r++)(n.g[u*i+r]==n.g[e*i+t]||n.g2[u*i+r]==n.g[e*i+t])&&!(u==e&&r==t)&&(n.o[u*i+r]||(n.o[u*i+r]=1,l++,n.t[u*i+r]!=0&&n.p[u*i+r]++),n.t[u*i+r]!=0&&n.p[u*i+r]--);return l}return n.p[e*i+t]++,n.g[e*i+t]||n.p[e*i+t]--,n.g[e*i+t]||(e-1>=0&&t-1>=0&&n.p[(e-1)*i+(t-1)]--,t-1>=0&&n.p[e*i+(t-1)]--,e+1<o&&t-1>=0&&n.p[(e+1)*i+(t-1)]--,e-1>=0&&n.p[(e-1)*i+t]--,e+1<o&&n.p[(e+1)*i+t]--,e-1>=0&&t+1<i&&n.p[(e-1)*i+(t+1)]--,t+1<i&&n.p[e*i+(t+1)]--,e+1<o&&t+1<i&&n.p[(e+1)*i+(t+1)]--),l}static m108(e,t,o,i,n){n.f[e*i+t]=1,e-1>=0&&t-1>=0&&n.p[(e-1)*i+(t-1)]++,t-1>=0&&n.p[e*i+(t-1)]++,e+1<o&&t-1>=0&&n.p[(e+1)*i+(t-1)]++,e-1>=0&&n.p[(e-1)*i+t]++,e+1<o&&n.p[(e+1)*i+t]++,e-1>=0&&t+1<i&&n.p[(e-1)*i+(t+1)]++,t+1<i&&n.p[e*i+(t+1)]++,e+1<o&&t+1<i&&n.p[(e+1)*i+(t+1)]++}}const ne=Object.freeze({UNREVEALED:"unrevealed",FLAG:"flag",MINE:"mine",MINERED:"minered",MINEWRONG:"minewrong"});class z{constructor(){throw new Error("Algorithms class only has static methods, and cannot be instantiated")}static calcBasicZini(e,t,o=!1,i=!1,n=!1){o||(o=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(e));const{numbersArray:l,openingLabels:u,preprocessedOpenings:r}=o,f=e.length,s=e[0].length;let a;i?a=i:a=new Array(f).fill(0).map(()=>new Array(s).fill(!1));let h;n?h=n:h=new Array(f).fill(0).map(()=>new Array(s).fill(!1));const c=this.computeSquareInfo(e,l,u),d=new Array(f).fill(0).map(()=>new Array(s).fill(null));for(let O=0;O<f;O++)for(let w=0;w<s;w++)e[O][w]||this.updatePremiumForCoord(O,w,c,h,a,d,r);let p=0;for(let O=0;O<f;O++)for(let w=0;w<s;w++)!e[O][w]&&!a[O][w]&&p++;let y;t?y=[[!1,!1,!1],[!0,!1,!1],[!1,!0,!1],[!0,!0,!1],[!1,!1,!0],[!0,!1,!0],[!1,!0,!0],[!0,!0,!0]]:y=[[!1,!1,!1]];let C=1/0,v=null;for(const O of y){const w=[],F=this.fast2dArrayCopy(h),g=this.fast2dArrayCopy(a),k=this.fast2dArrayCopy(d);let P=0;const b=new xe(O[0],O[1],O[2],f,s,!0);for(let A=0;A<f;A++)for(let m=0;m<s;m++)e[A][m]||b.lazyAddPremium(A,m,d[A][m]);b.sortAfterLazyAdd();let x=!1;for(;P!==p;){let A=this.doBasicZiniStep(c,F,g,k,r,w,O[0],O[1],O[2],b);if(P+=A.newlyRevealed,A.onlyNFRemaining){x=!0;break}}x&&this.nfClickEverythingForZini(c,g,r,w),w.length<C&&(C=w.length,v=w)}return{total:C,clicks:v}}static doBasicZiniStep(e,t,o,i,n,l,u,r,f,s=!1){const a=o.length,h=o[0].length;let c=0,d=-1,p=null,y=null;if(s){const{x:v,y:O,premium:w}=s.getHighestPremium();y={x:v,y:O},d=w}else{const v=u?a-1:0,O=u?0:a-1,w=r?h-1:0,F=r?0:h-1,g=f?w:v,k=f?F:O,P=f?v:w,b=f?O:F,x=f?r:u,A=f?u:r;for(let m=g;x?m>=0:m<=k;x?m--:m++)for(let I=P;A?I>=0:I<=b;A?I--:I++){const[M,T]=f?[I,m]:[m,I],N=e[M][T];N.isMine||(p===null&&N.is3bv&&(o[M][T]||(p={x:M,y:T})),d<i[M][T]&&(d=i[M][T],y={x:M,y:T}))}}if(s&&d<=-1)return{newlyRevealed:0,onlyNFRemaining:!0};let C=[];if(y===null){if(p===null)throw new Error("No chords or NF clicks found?");if(o[p.x][p.y])throw new Error("Square already revealed? Should never happen");l.push({type:"left",x:p.x,y:p.y}),o[p.x][p.y]=!0,c++;for(let O of e[p.x][p.y].safeNeighbours)C.push({x:O.x,y:O.y});const v=e[p.x][p.y].labelIfOpening;if(v!==null){const O=n.get(v);for(let w of O.zeros)o[w.x][w.y]||(o[w.x][w.y]=!0,c++);for(let w of O.edges)o[w.x][w.y]||(o[w.x][w.y]=!0,c++),C.push({x:w.x,y:w.y})}}else{const v=e[y.x][y.y],O=v.mineNeighbours.filter(F=>!t[F.x][F.y]);o[y.x][y.y]||(l.push({type:"left",x:y.x,y:y.y}),o[y.x][y.y]=!0,c++);for(let F of O)l.push({type:"right",x:F.x,y:F.y}),t[F.x][F.y]=!0;l.push({type:"chord",x:y.x,y:y.y});const w=[...v.openingsTouched].map(F=>n.get(F)).filter(F=>{const g=F.zeros[0];return!o[g.x][g.y]});for(let F of w){for(let g of F.zeros)o[g.x][g.y]||(o[g.x][g.y]=!0,c++);for(let g of F.edges)o[g.x][g.y]||(o[g.x][g.y]=!0,c++),C.push({x:g.x,y:g.y})}for(let F of v.safeNeighbours)o[F.x][F.y]||(o[F.x][F.y]=!0,c++);for(let F=y.x-2;F<=y.x+2;F++)for(let g=y.y-2;g<=y.y+2;g++)C.push({x:F,y:g})}C=C.filter((v,O,w)=>O===w.findIndex(F=>F.x===v.x&&F.y===v.y));for(let v of C)this.updatePremiumForCoord(v.x,v.y,e,t,o,i,n,s);return{newlyRevealed:c,onlyNFRemaining:!1}}static computeSquareInfo(e,t,o){const i=e.length,n=e[0].length,l=new Array(i).fill(0).map(()=>new Array(n).fill(0).map(()=>({isMine:!1,number:null,is3bv:null,labelIfOpening:null,mineNeighbours:[],safeNeighbours:[],nonOpening3bvNeighbours:[],openingsTouched:new Set})));for(let u=0;u<i;u++)for(let r=0;r<n;r++){const f=l[u][r];if(e[u][r]){f.isMine=!0;continue}f.number=t[u][r],o[u][r]===0||t[u][r]===0?f.is3bv=!0:f.is3bv=!1,t[u][r]===0&&(f.labelIfOpening=o[u][r]);for(let s=u-1;s<=u+1;s++)for(let a=r-1;a<=r+1;a++)if(!(s<0||s>=i||a<0||a>=n)&&!(s===u&&a===r)){if(e[s][a]){f.mineNeighbours.push({x:s,y:a});continue}else f.safeNeighbours.push({x:s,y:a});o[s][a]===0?f.nonOpening3bvNeighbours.push({x:s,y:a}):typeof o[s][a]=="number"&&t[u][r]!==0&&f.openingsTouched.add(o[s][a])}}return l}static nfClickEverythingForZini(e,t,o,i){const n=t.length,l=t[0].length;for(let u=0;u<n;u++)for(let r=0;r<l;r++){const f=e[u][r];if(f.isMine||t[u][r]||!f.is3bv)continue;i.push({type:"left",x:u,y:r}),t[u][r]=!0;const s=e[u][r].labelIfOpening;if(s!==null){const a=o.get(s);for(let h of a.zeros)t[h.x][h.y]=!0;for(let h of a.edges)t[h.x][h.y]=!0}}}static calcEightWayZini(e,t=!1,o=!1,i=!1){return this.calcBasicZini(e,!0,t,o,i)}static calcOneWayZini(e,t=!1){return this.calcBasicZini(e,!1,t)}static updatePremiumForCoord(e,t,o,i,n,l,u,r=!1){const f=n.length,s=n[0].length;if(e<0||e>=f||t<0||t>=s)return;const a=o[e][t];if(a.isMine)return;if(a.number===0){l[e][t]=-1;return}let h=0;for(let v of a.nonOpening3bvNeighbours)n[v.x][v.y]||h++;let c=0;for(let v of a.openingsTouched){const O=u.get(v).zeros[0];n[O.x][O.y]||c++}let d=0;for(let v of a.mineNeighbours)i[v.x][v.y]||d++;const p=h+c;let y=0;!a.is3bv&&!n[e][t]&&(y=1);const C=p-d-1-y;r&&r.updatePremium(e,t,l[e][t],C),l[e][t]=C}static getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(e){var r;const t=e.length,o=e[0].length,i=new Array(t).fill(0).map(()=>new Array(o).fill(0));for(let f=0;f<t;f++)for(let s=0;s<o;s++)if(!!e[f][s]){i[f][s]="x";for(let a=f-1;a<=f+1;a++)for(let h=s-1;h<=s+1;h++)((r=e[a])==null?void 0:r[h])===!1&&i[a][h]++}let n=new Array(t).fill(0).map(()=>new Array(o).fill(0)),l=0;const u=new Map;for(let f=0;f<t;f++)for(let s=0;s<o;s++){if(e[f][s]){n[f][s]="x";continue}if(i[f][s]===0&&n[f][s]===0){l++;let a={zeros:[],edges:[]};u.set(l,a),this.floodOpeningForProcessing(f,s,e,n,i,u,l)}}return{numbersArray:i,openingLabels:n,preprocessedOpenings:u}}static floodOpeningForProcessing(e,t,o,i,n,l,u){var r;if(((r=i[e])==null?void 0:r[t])!==void 0&&i[e][t]!==u)if(n[e][t]!==0){i[e][t]="+";const f=l.get(u);f.edges.some(s=>s.x===e&&s.y===t)||f.edges.push({x:e,y:t});return}else n[e][t]===0&&(i[e][t]=u,l.get(u).zeros.push({x:e,y:t}),this.floodOpeningForProcessing(e-1,t-1,o,i,n,l,u),this.floodOpeningForProcessing(e-1,t,o,i,n,l,u),this.floodOpeningForProcessing(e-1,t+1,o,i,n,l,u),this.floodOpeningForProcessing(e,t-1,o,i,n,l,u),this.floodOpeningForProcessing(e,t+1,o,i,n,l,u),this.floodOpeningForProcessing(e+1,t-1,o,i,n,l,u),this.floodOpeningForProcessing(e+1,t,o,i,n,l,u),this.floodOpeningForProcessing(e+1,t+1,o,i,n,l,u))}static calc3bv(e,t=!1,o=!1){const i=e.length,n=e[0].length;let l;o?l=o.openingLabels:l=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(e).openingLabels;const u=new Set(l.flat().filter(a=>typeof a=="number"&&a!==0)).size,r=l.flat().filter(a=>a===0).length;let f=u+r,s=0;if(t){let a=0,h=new Set;for(let c=0;c<i;c++)for(let d=0;d<n;d++)typeof t[c][d].state=="number"&&(l[c][d]===0?a++:typeof l[c][d]=="number"&&h.add(l[c][d]));s=a+h.size}return{bbbv:f,solved3bv:s}}static fast2dArrayCopy(e){return e.map(t=>t.slice())}static fisherYatesArrayShuffle(e,t=!1){t||(t=Math.random);for(var o=e.length,i,n;--o>0;)i=Math.floor(t()*(o+1)),n=e[i],e[i]=e[o],e[o]=n}static basicShuffle(e,t,o,i=null,n=!1){let l=[];if(i&&(l.push({x:i.x,y:i.y}),n))for(let s=i.x-1;s<=i.x+1;s++)for(let a=i.y-1;a<=i.y+1;a++)s===i.x&&a===i.y||s>=0&&s<=e-1&&a>=0&&a<=t-1&&l.push({x:s,y:a});if(e*t-l.length<o)if(e*t-1>=o)l=[{x:i.x,y:i.y}];else throw new Error(`Cannot generate ${e}x${t}/${o}`);const u=new Array(e*t-l.length).fill(!1);for(let s=0;s<o;s++)u[s]=!0;this.fisherYatesArrayShuffle(u);const r=new Array(e).fill(0).map(()=>new Array(t).fill(!1));let f=0;for(let s=0;s<e;s++)for(let a=0;a<t;a++)l.some(h=>h.x===s&&h.y===a)||(r[s][a]=u[f],f++);return r}static effBoardShuffle(e,t,o,i,n,l){const u=performance.now();let r=!1;for(;!r;){if(performance.now()-u>l*1e3)return!1;let f=this.basicShuffle(e,t,o,i,!0),s=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(f);const a=this.calc3bv(f,!1,s).bbbv,h=this.calcBasicZini(f,!1,s).total;let c=a/(a-(a-h)*1.15-2)>=n/100;if(a/(h-this.get99thPercentileSubzini(e,t,o,a,h))>=n/100,c){const d=this.calcBasicZini(f,!0,s).total;a/d>=n/100&&(r=f)}}return r}static get99thPercentileSubzini(e,t,o,i,n){const l=`${e}-${t}-${o}`;let u=null;switch(l){case"9-9-10":u=[5,9,14,25,40,1/0];break;case"16-16-40":u=[0,0,0,33,70,90,100,110,120,1/0];break;case"30-16-99":u=[0,0,0,0,0,0,0,170,200,216,222,227,230,235,1/0];break;default:u=null}if(u){let r=0;for(let f=0;f<u.length;f++)if(i<=u[f]){r=f;break}return r}else return(i-n)*.15+2}static getRandomZeroCell(e){let t=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(e).numbersArray,o=e.length,i=e[0].length,n=[];for(let l=0;l<o;l++)for(let u=0;u<i;u++)t[l][u]===0&&n.push({x:l,y:u});if(n.length===0)for(;;){let l=Math.floor(Math.random()*o),u=Math.floor(Math.random()*i);if(!e[l][u])return{x:l,y:u}}return n[Math.floor(Math.random()*n.length)]}static calcWomZiniAndHZini(e,t=!1){const o=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(e);let i=ie.createWomBoardDataObject(e,o,t);const n=e.length,l=e[0].length,u=e.flat().filter(h=>h).length;let{total:r,clicks:f}=ie.c215(!1,i,n,l,u),{total:s,clicks:a}=ie.c215(!0,i,n,l,u);return r>s&&(r=s,f=structuredClone(a)),{womZini:{total:r,clicks:f},womHzini:{total:s,clicks:a}}}static reorderZiniClicks(e,t){e=structuredClone(e);const o=t.length,i=t[0].length,{numbersArray:n,openingLabels:l,preprocessedOpenings:u}=this.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(t);let r={opening:[],setupClick:[],flags:[],chords:[],cleanup:[]};for(let f of e){if(f.type==="left"){if(n[f.x][f.y]===0){r.opening.push(f);continue}let s=null;for(let h=f.x-1;h<=f.x+1;h++){let c=!1;for(let d=f.y-1;d<=f.y+1;d++)if(!(h<0||h>=o||d<0||d>=i)&&n[h][d]===0){s={x:h,y:d},c=!0;break}if(c)break}if(s){f.x=s.x,f.y=s.y,r.opening.push(f);continue}if(e.some(h=>h.type==="chord"&&h.x===f.x&&h.y===f.y)){r.setupClick.push(f);continue}else{r.cleanup.push(f);continue}}if(f.type==="right"){r.flags.push(f);continue}if(f.type==="chord"){r.chords.push(f);continue}}return e=[...r.opening,...r.setupClick,...r.flags,...r.chords,...r.cleanup],e}static getPttaMinesString(e){const t=e.length,o=e[0].length;let i="";const n=t*o;for(var l=0;l<n;l+=5){for(var u=0,r=l;r<l+5;r++)r>=n||e[r%t][Math.floor(r/t)]===!1?u*=2:(u*=2,u++);i+=u.toString(32)}return i}static getPttaDimensionString(e){const t=e.length,o=e[0].length;let i;if(t===9&&o===9)i="1";else if(t===16&&o===16)i="2";else if(t===30&&o===16)i="3";else{let n=t.toString().length;i=t.toString()+o.toString().padStart(n,"0")}return i}static encodeClicks(e,t,o){const i=new me,n={left:0,right:1,chord:2},l=Math.ceil(Math.log2(t*o));e.forEach(f=>{const s=n[f.type],a=f.x*o+f.y;i.writeBits(s,2),i.writeBits(a,l)}),i.writeBits(3,2);let u=i.getBytes(),r=String.fromCharCode(...u);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static decodeClicks(e,t,o){try{const n=(e+"===".slice((e.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/"),l=atob(n),u=Uint8Array.from(l,h=>h.charCodeAt(0)),r=new be(u),f={0:"left",1:"right",2:"chord"},s=Math.ceil(Math.log2(t*o)),a=[];for(;r.bitPos+2<u.length*8;){const h=r.readBits(2);if(h===3)break;const c=r.readBits(s),d=Math.floor(c/o),p=c%o;if(d>=t||p>=o)return!1;a.push({type:f[h],x:d,y:p})}return a}catch{return!1}}static getCompressedData(e,t){const o=t.length,i=t[0].length,n=t.flat().filter(c=>c).length;let l="";for(let c=0;c<i;c++)for(let d=0;d<o;d++){const p=e[d][c];if(t[d][c]&&p.state===ne.FLAG)p.state===ne.FLAG?l=l+"F":l=l+"H";else if(typeof p.state=="number"){const y=p.state;let C=0;for(let v=d-1;v<=d+1;v++)for(let O=c-1;O<=c+1;O++)v<0||v>=o||O<0||O>=i||v===d&&O===c||t[v][O]&&e[v][O].state===ne.FLAG&&C++;if(C>y)throw new Error(`Tile at x: ${d}, y: ${c} has too many flags around it, can't compress invalid data`);l=l+(y-C)}else l=l+"H"}const u=new we;let r=u.compressNumber(o,2),f=u.compressNumber(i,2),s=u.compressNumber(n,4),a=u.compress(l),h=r+f+s+a;return console.log("Compressed data length "+h.length+" analysis="+h),{width:o,height:i,mineCount:n,analysis:h}}}class me{constructor(){this.bits=[],this.bitPos=0}writeBits(e,t){for(let o=t-1;o>=0;o--){const i=e>>o&1,n=Math.floor(this.bitPos/8),l=7-this.bitPos%8;this.bits[n]===void 0&&(this.bits[n]=0),this.bits[n]|=i<<l,this.bitPos++}}getBytes(){return new Uint8Array(this.bits)}}class be{constructor(e){this.bytes=e,this.bitPos=0}readBits(e){let t=0;for(let o=0;o<e;o++){const i=Math.floor(this.bitPos/8),n=7-this.bitPos%8,l=this.bytes[i]>>n&1;t=t<<1|l,this.bitPos++}return t}}class we{constructor(){this.BASE62="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",this.VALUES=["0","1","2","3","4","5","6","7","8","I","H","F","O"],this.BASES=[10,7,5,5,4,3,3,1,1,4,10,8,1],this.digits=[];let e=0;for(const t of this.BASES)this.digits.push(this.BASE62.substring(e,e+t)),e=e+t}compress(e){let t="",o=0,i="";for(let n=0;n<e.length;n++){let l=e.charAt(n);i==""?(i=l,o=1):l==i?o++:(t=t+this.compressFragment(i,o),i=l,o=1)}return t=t+this.compressFragment(i,o),t}compressFragment(e,t){let o=this.VALUES.indexOf(e);if(o==-1)return console.log("Unable to find the value '"+e+"' in the compression values array"),"";let i=this.digits[o],n=i.length;if(n==1)return i.repeat(t);let l="";for(;t!=0;){let u=t%n;l=i[u]+l,t=(t-u)/n}return l}decompress(e){let t="",o=0,i="";for(let n=0;n<e.length;n++){let l=e.charAt(n),u=this.digits.findIndex(a=>a.includes(l)),r=this.VALUES[u],f=this.digits[u].indexOf(l),s=this.digits[u].length;i==""?(i=r,o=f):r==i?s==1?o++:o=o*s+f:(t=t+i.repeat(o),i=r,s==1?o=1:o=f)}return t=t+i.repeat(o),t}compressNumber(e,t){const o=this.BASE62.length;let i="";for(let n=0;n<t;n++){let l=e%o;i=this.BASE62[l]+i,e=(e-l)/o}return i}decompressNumber(e){const t=this.BASE62.length;let o=0;for(let i=0;i<e.length;i++){let n=this.BASE62.indexOf(e.charAt(i));o=o*t+n}return o}}class Ae{constructor(e,t){this.premiumsMap=new Map,this.priorityGrid=e,this.excludeNegativePremiums=t}addPremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToPriority(e,t),n=this.premiumsMap.get(o);if(!Array.isArray(n))this.premiumsMap.set(o,[{x:e,y:t,priority:i}]);else{let l=this.sortedIndex(n,i);n.splice(l,0,{x:e,y:t,priority:i})}}lazyAddPremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToPriority(e,t),n=this.premiumsMap.get(o);Array.isArray(n)?n.push({x:e,y:t,priority:i}):this.premiumsMap.set(o,[{x:e,y:t,priority:i}])}sortAfterLazyAdd(){for(let e of this.premiumsMap.values())e.sort((t,o)=>t.priority-o.priority)}removePremium(e,t,o){if(this.excludeNegativePremiums&&o<0)return;let i=this.xyToPriority(e,t),n=this.premiumsMap.get(o),l=this.sortedIndex(n,i);if(n[l].priority!==i)throw new Error("Priority not found in premiums array?");n.splice(l,1),n.length===0&&this.premiumsMap.delete(o)}updatePremium(e,t,o,i){o!==i&&(this.removePremium(e,t,o),this.addPremium(e,t,i))}getHighestPremium(){if(this.premiumsMap.size===0){if(this.excludeNegativePremiums)return{x:"not stored",y:"not stored",premium:-1};throw new Error("Empty map")}const e=Math.max.apply(null,[...this.premiumsMap.keys()]);let t=this.premiumsMap.get(e)[0],{x:o,y:i}=t;return{x:o,y:i,premium:e}}xyToPriority(e,t){return this.priorityGrid[e][t]}sortedIndex(e,t){for(var o=0,i=e.length;o<i;){var n=o+i>>>1;e[n].priority<t?o=n+1:i=n}return o}}class Z{static clamp(e,t,o){return Math.max(Math.min(e,o),t)}static isMobile(){return/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static deleteValueFromArray(e,t){let o=e.indexOf(t);return o!==-1?(e.splice(o,1),!0):!1}static setTimeoutWrapper(...e){setTimeout(...e)}static formatTime(e){e=Math.floor(e);const t=Math.floor(e/(24*3600));e%=24*3600;const o=Math.floor(e/3600);e%=3600;const i=Math.floor(e/60);return e%=60,t>0?`${t}d ${o}h`:o>0?`${o}h ${i}m`:i>0?`${i}m ${e}s`:`${e}s`}static timeInFuture(e){const t=new Date,o=new Date(t.getTime()+e*1e3),i=t.toDateString()===o.toDateString(),n=o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});if(i)return`${n}`;{const l=o.toLocaleDateString();return`${n} on ${l}`}}static variantToRouteName(e){const t={normal:"normal","eff boards":"eff-boards","board editor":"board-editor","zini explorer":"zini-explorer","mean openings":"mean-openings"};return t[e]?t[e]:"normal"}static routeNameToVariant(e){const t={normal:"normal","eff-boards":"eff boards","board-editor":"board editor","zini-explorer":"zini explorer","mean-openings":"mean openings"};return t[e]?t[e]:"normal"}static shallowObjectEquals(e,t){if(e===t)return!0;if(typeof e!="object"||typeof t!="object")return!1;const o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(const n of o)if(e[n]!==t[n])return!1;return!0}static shallow2DArrayEquals(e,t){if(e.length!==t.length||e[0].length!==t[0].length)return!1;let o=e.length,i=e[0].length;for(let n=0;n<o;n++)for(let l=0;l<i;l++)if(e[n][l]!==t[n][l])return!1;return!0}}class H{constructor(){this.path=[],this.isFloatingSeed=!0,this.seedLocationsIfFixed=[],this.isUnchordedDig=!1,this.positionIfUnchordedDig=!1,this.openingsTouched=[]}addToPath(e,t){this.path.push({x:e,y:t})}addOpeningTouched(e){this.openingsTouched.includes(e)||this.openingsTouched.push(e)}mergeWithPath(e){this.path=this.path.concat(e)}mergeWithOpeningsTouched(e){for(let t of e)this.openingsTouched.includes(t)||this.openingsTouched.push(t)}getClickCount(){return this.isUnchordedDig?1:this.isFloatingSeed?this.path.length+1:this.path.length+this.seedLocationsIfFixed.length}cloneChain(){let e=new H;return e.path=this.path.map(t=>({x:t.x,y:t.y})),e.isFloatingSeed=this.isFloatingSeed,e.seedLocationsIfFixed=this.seedLocationsIfFixed.map(t=>({x:t.x,y:t.y})),e.isUnchordedDig=this.isUnchordedDig,e.positionIfUnchordedDig=this.positionIfUnchordedDig,e.openingsTouched=this.openingsTouched.slice(),e}}var Y=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},oe={exports:{}};(function(S){(function(e,t,o){function i(r){var f=this,s=u();f.next=function(){var a=2091639*f.s0+f.c*23283064365386963e-26;return f.s0=f.s1,f.s1=f.s2,f.s2=a-(f.c=a|0)},f.c=1,f.s0=s(" "),f.s1=s(" "),f.s2=s(" "),f.s0-=s(r),f.s0<0&&(f.s0+=1),f.s1-=s(r),f.s1<0&&(f.s1+=1),f.s2-=s(r),f.s2<0&&(f.s2+=1),s=null}function n(r,f){return f.c=r.c,f.s0=r.s0,f.s1=r.s1,f.s2=r.s2,f}function l(r,f){var s=new i(r),a=f&&f.state,h=s.next;return h.int32=function(){return s.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,a&&(typeof a=="object"&&n(a,s),h.state=function(){return n(s,{})}),h}function u(){var r=4022871197,f=function(s){s=String(s);for(var a=0;a<s.length;a++){r+=s.charCodeAt(a);var h=.02519603282416938*r;r=h>>>0,h-=r,h*=r,r=h>>>0,h-=r,r+=h*4294967296}return(r>>>0)*23283064365386963e-26};return f}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.alea=l})(Y,S,!1)})(oe);var re={exports:{}};(function(S){(function(e,t,o){function i(u){var r=this,f="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var a=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^a^a>>>8},u===(u|0)?r.x=u:f+=u;for(var s=0;s<f.length+64;s++)r.x^=f.charCodeAt(s)|0,r.next()}function n(u,r){return r.x=u.x,r.y=u.y,r.z=u.z,r.w=u.w,r}function l(u,r){var f=new i(u),s=r&&r.state,a=function(){return(f.next()>>>0)/4294967296};return a.double=function(){do var h=f.next()>>>11,c=(f.next()>>>0)/4294967296,d=(h+c)/(1<<21);while(d===0);return d},a.int32=f.next,a.quick=a,s&&(typeof s=="object"&&n(s,f),a.state=function(){return n(f,{})}),a}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.xor128=l})(Y,S,!1)})(re);var se={exports:{}};(function(S){(function(e,t,o){function i(u){var r=this,f="";r.next=function(){var a=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(a^a<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,u===(u|0)?r.x=u:f+=u;for(var s=0;s<f.length+64;s++)r.x^=f.charCodeAt(s)|0,s==f.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function n(u,r){return r.x=u.x,r.y=u.y,r.z=u.z,r.w=u.w,r.v=u.v,r.d=u.d,r}function l(u,r){var f=new i(u),s=r&&r.state,a=function(){return(f.next()>>>0)/4294967296};return a.double=function(){do var h=f.next()>>>11,c=(f.next()>>>0)/4294967296,d=(h+c)/(1<<21);while(d===0);return d},a.int32=f.next,a.quick=a,s&&(typeof s=="object"&&n(s,f),a.state=function(){return n(f,{})}),a}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.xorwow=l})(Y,S,!1)})(se);var le={exports:{}};(function(S){(function(e,t,o){function i(u){var r=this;r.next=function(){var s=r.x,a=r.i,h,c;return h=s[a],h^=h>>>7,c=h^h<<24,h=s[a+1&7],c^=h^h>>>10,h=s[a+3&7],c^=h^h>>>3,h=s[a+4&7],c^=h^h<<7,h=s[a+7&7],h=h^h<<13,c^=h^h<<9,s[a]=c,r.i=a+1&7,c};function f(s,a){var h,c=[];if(a===(a|0))c[0]=a;else for(a=""+a,h=0;h<a.length;++h)c[h&7]=c[h&7]<<15^a.charCodeAt(h)+c[h+1&7]<<13;for(;c.length<8;)c.push(0);for(h=0;h<8&&c[h]===0;++h);for(h==8?c[7]=-1:c[h],s.x=c,s.i=0,h=256;h>0;--h)s.next()}f(r,u)}function n(u,r){return r.x=u.x.slice(),r.i=u.i,r}function l(u,r){u==null&&(u=+new Date);var f=new i(u),s=r&&r.state,a=function(){return(f.next()>>>0)/4294967296};return a.double=function(){do var h=f.next()>>>11,c=(f.next()>>>0)/4294967296,d=(h+c)/(1<<21);while(d===0);return d},a.int32=f.next,a.quick=a,s&&(s.x&&n(s,f),a.state=function(){return n(f,{})}),a}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.xorshift7=l})(Y,S,!1)})(le);var ae={exports:{}};(function(S){(function(e,t,o){function i(u){var r=this;r.next=function(){var s=r.w,a=r.X,h=r.i,c,d;return r.w=s=s+1640531527|0,d=a[h+34&127],c=a[h=h+1&127],d^=d<<13,c^=c<<17,d^=d>>>15,c^=c>>>12,d=a[h]=d^c,r.i=h,d+(s^s>>>16)|0};function f(s,a){var h,c,d,p,y,C=[],v=128;for(a===(a|0)?(c=a,a=null):(a=a+"\0",c=0,v=Math.max(v,a.length)),d=0,p=-32;p<v;++p)a&&(c^=a.charCodeAt((p+32)%a.length)),p===0&&(y=c),c^=c<<10,c^=c>>>15,c^=c<<4,c^=c>>>13,p>=0&&(y=y+1640531527|0,h=C[p&127]^=c+y,d=h==0?d+1:0);for(d>=128&&(C[(a&&a.length||0)&127]=-1),d=127,p=4*128;p>0;--p)c=C[d+34&127],h=C[d=d+1&127],c^=c<<13,h^=h<<17,c^=c>>>15,h^=h>>>12,C[d]=c^h;s.w=y,s.X=C,s.i=d}f(r,u)}function n(u,r){return r.i=u.i,r.w=u.w,r.X=u.X.slice(),r}function l(u,r){u==null&&(u=+new Date);var f=new i(u),s=r&&r.state,a=function(){return(f.next()>>>0)/4294967296};return a.double=function(){do var h=f.next()>>>11,c=(f.next()>>>0)/4294967296,d=(h+c)/(1<<21);while(d===0);return d},a.int32=f.next,a.quick=a,s&&(s.X&&n(s,f),a.state=function(){return n(f,{})}),a}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.xor4096=l})(Y,S,!1)})(ae);var fe={exports:{}};(function(S){(function(e,t,o){function i(u){var r=this,f="";r.next=function(){var a=r.b,h=r.c,c=r.d,d=r.a;return a=a<<25^a>>>7^h,h=h-c|0,c=c<<24^c>>>8^d,d=d-a|0,r.b=a=a<<20^a>>>12^h,r.c=h=h-c|0,r.d=c<<16^h>>>16^d,r.a=d-a|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,u===Math.floor(u)?(r.a=u/4294967296|0,r.b=u|0):f+=u;for(var s=0;s<f.length+20;s++)r.b^=f.charCodeAt(s)|0,r.next()}function n(u,r){return r.a=u.a,r.b=u.b,r.c=u.c,r.d=u.d,r}function l(u,r){var f=new i(u),s=r&&r.state,a=function(){return(f.next()>>>0)/4294967296};return a.double=function(){do var h=f.next()>>>11,c=(f.next()>>>0)/4294967296,d=(h+c)/(1<<21);while(d===0);return d},a.int32=f.next,a.quick=a,s&&(typeof s=="object"&&n(s,f),a.state=function(){return n(f,{})}),a}t&&t.exports?t.exports=l:o&&o.amd?o(function(){return l}):this.tychei=l})(Y,S,!1)})(fe);var ue={exports:{}};(function(S){(function(e,t,o){var i=256,n=6,l=52,u="random",r=o.pow(i,n),f=o.pow(2,l),s=f*2,a=i-1,h;function c(w,F,g){var k=[];F=F==!0?{entropy:!0}:F||{};var P=C(y(F.entropy?[w,O(t)]:w==null?v():w,3),k),b=new d(k),x=function(){for(var A=b.g(n),m=r,I=0;A<f;)A=(A+I)*i,m*=i,I=b.g(1);for(;A>=s;)A/=2,m/=2,I>>>=1;return(A+I)/m};return x.int32=function(){return b.g(4)|0},x.quick=function(){return b.g(4)/4294967296},x.double=x,C(O(b.S),t),(F.pass||g||function(A,m,I,M){return M&&(M.S&&p(M,b),A.state=function(){return p(b,{})}),I?(o[u]=A,m):A})(x,P,"global"in F?F.global:this==o,F.state)}function d(w){var F,g=w.length,k=this,P=0,b=k.i=k.j=0,x=k.S=[];for(g||(w=[g++]);P<i;)x[P]=P++;for(P=0;P<i;P++)x[P]=x[b=a&b+w[P%g]+(F=x[P])],x[b]=F;(k.g=function(A){for(var m,I=0,M=k.i,T=k.j,N=k.S;A--;)m=N[M=a&M+1],I=I*i+N[a&(N[M]=N[T=a&T+m])+(N[T]=m)];return k.i=M,k.j=T,I})(i)}function p(w,F){return F.i=w.i,F.j=w.j,F.S=w.S.slice(),F}function y(w,F){var g=[],k=typeof w,P;if(F&&k=="object")for(P in w)try{g.push(y(w[P],F-1))}catch{}return g.length?g:k=="string"?w:w+"\0"}function C(w,F){for(var g=w+"",k,P=0;P<g.length;)F[a&P]=a&(k^=F[a&P]*19)+g.charCodeAt(P++);return O(F)}function v(){try{var w;return h&&(w=h.randomBytes)?w=w(i):(w=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(w)),O(w)}catch{var F=e.navigator,g=F&&F.plugins;return[+new Date,e,g,e.screen,O(t)]}}function O(w){return String.fromCharCode.apply(0,w)}if(C(o.random(),t),S.exports){S.exports=c;try{h=require("crypto")}catch{}}else o["seed"+u]=c})(typeof self!="undefined"?self:Y,[],Math)})(ue);var Ce=oe.exports,ve=re.exports,Me=se.exports,Fe=le.exports,Oe=ae.exports,Ie=fe.exports,K=ue.exports;K.alea=Ce,K.xor128=ve,K.xorwow=Me,K.xorshift7=Fe,K.xor4096=Oe,K.tychei=Ie;var Te=K;class te{constructor(){throw new Error("ChainZini class only has static methods, and cannot be instantiated")}static calcChainZini({mines:e,preprocessedData:t=!1,initialRevealedStates:o=!1,initialFlagStates:i=!1,initialChainIds:n=!1,initialChainMap:l=!1,initialChainNeighbourhoodGrid:u=!1,chainSquareInfo:r=!1,initialChainPremiums:f=!1,priorityGrids:s=!1,returnAllZinis:a=!1,includeClickPath:h=!1,forbiddenGrid:c=!1}){const d=e.length,p=e[0].length;t=this.getPreprocessedDataIfFalse(t,e);const{numbersArray:y,openingLabels:C,preprocessedOpenings:v}=t;let O=this.getBlankRevealedStatesIfFalse(o,d,p),{flagStates:w,flagsPlacedBefore:F}=this.getBlankFlagStatesIfFalse(i,d,p),g=this.getBlankChainIdsIfFalse(n,d,p),{chainMap:k,nextChainId:P}=this.getBlankChainMapIfFalse(l),b=this.getBlankChainNeighbourhoodGridIfFalse(u,d,p);r=this.computeChainSquareInfoIfFalse(r,e,y,C,v);let x=this.getChainPremiumsIfFalse(f,e,r,w,O,v,g,k,b,d,p,c),A=0;for(let N=0;N<d;N++)for(let R=0;R<p;R++)!e[N][R]&&!O[N][R]&&A++;s||(s=[Q.createBasic(d,p)]);let m=1/0,I=null,M=[];for(let N=0;N<s.length;N++){let R=s[N];const B=z.fast2dArrayCopy(g),U=this.cloneChainMap(k),J=this.cloneChainNeighbourhoodGrid(b),V=z.fast2dArrayCopy(w),G=z.fast2dArrayCopy(O),W=z.fast2dArrayCopy(x);let j=0,ee=F;const q={id:P},L=new Ae(R,!0);for(let D=0;D<d;D++)for(let $=0;$<p;$++)e[D][$]||L.lazyAddPremium(D,$,x[D][$]);L.sortAfterLazyAdd();let E=!1;for(;j!==A;){let D=this.doChainZiniStep(r,V,G,W,v,B,U,J,L,q,c);if(j+=D.newlyRevealed,ee+=D.flagsPlaced,D.onlyNFRemaining){E=!0;break}typeof window!="undefined"&&window.validate&&this.checkChainStuffConsistent(r,V,G,W,v,B,U,J,L)}E&&this.nfClickEverythingForChainZini(r,G,v,B,U,q);let X=ee;for(let D of U.values())X+=D.getClickCount();X<m&&(m=X,I={chainIds:B,chainMap:U,flagStates:V}),a&&(M[N]=X)}let T={total:m,solution:I};return a&&(T.allZinis=M),h&&(T.clicks=this.convertSolutionToClickPath({chainIds:I.chainIds,chainMap:I.chainMap,mines:e,chainSquareInfo:r,preprocessedOpenings:v})),T}static computeChainSquareInfo(e,t,o,i){const n=e.length,l=e[0].length,u=new Array(n).fill(0).map(()=>new Array(l).fill(0).map(()=>({isMine:!1,number:null,is3bv:null,labelIfOpening:null,mineNeighbours:[],safeNeighbours:[],nonOpening3bvNeighbours:[],openingsTouched:new Set,chainNeighbours:[]})));for(let r=0;r<n;r++)for(let f=0;f<l;f++){const s=u[r][f];if(e[r][f]){s.isMine=!0;continue}s.number=t[r][f],o[r][f]===0||t[r][f]===0?s.is3bv=!0:s.is3bv=!1,t[r][f]===0&&(s.labelIfOpening=o[r][f]);for(let a=r-1;a<=r+1;a++)for(let h=f-1;h<=f+1;h++)if(!(a<0||a>=n||h<0||h>=l)&&!(a===r&&h===f)){if(e[a][h]){s.mineNeighbours.push({x:a,y:h});continue}else s.safeNeighbours.push({x:a,y:h});o[a][h]===0?s.nonOpening3bvNeighbours.push({x:a,y:h}):typeof o[a][h]=="number"&&t[r][f]!==0&&s.openingsTouched.add(o[a][h])}}return u}static updateChainPremiumForCoord(e,t,o,i,n,l,u,r,f,s,a=!1,h=!1){const c=n.length,d=n[0].length;if(e<0||e>=c||t<0||t>=d)return;const p=o[e][t];if(p.isMine)return;if(p.number===0){l[e][t]=-1;return}if(h&&h[e][t]){l[e][t]=-100;return}if(r[e][t]!==null&&!f.get(r[e][t]).isUnchordedDig){a&&a.updatePremium(e,t,l[e][t],-1),l[e][t]=-1;return}let y=0;for(let P of p.nonOpening3bvNeighbours)n[P.x][P.y]||y++;let C=0;for(let P of p.openingsTouched){const b=u.get(P).zeros[0];n[b.x][b.y]||C++}let v=0;for(let P of p.mineNeighbours)i[P.x][P.y]||v++;const O=y+C;let w=0;!p.is3bv&&!n[e][t]&&(w=1);const F=s[e][t],g=Math.max(0,F.floating.length+Math.min(1,F.fixed.length)-1),k=O-v-1-w+g;a&&a.updatePremium(e,t,l[e][t],k),l[e][t]=k}static doChainZiniStep(e,t,o,i,n,l,u,r,f,s,a=!1){const{x:h,y:c,premium:d}=f.getHighestPremium();return d<=-1?{newlyRevealed:0,flagsPlaced:0,onlyNFRemaining:!0}:this.doChainChord(h,c,e,t,o,i,n,l,u,r,f,s,a)}static doChainChord(e,t,o,i,n,l,u,r,f,s,a,h,c=!1){let d=0,p=0;const y={x:e,y:t};let C=[];const v=o[y.x][y.y],O=s[y.x][y.y],w=O.floating.slice(),F=O.fixed.slice();let g=null;if(F.length!==0)g=F[0];else if(w.length!==0){let b=-1;for(const x of w){const A=f.get(x);if(A.isUnchordedDig){const m=A.positionIfUnchordedDig;if(x===r[y.x][y.y]||o[m.x][m.y].number===0){A.openingsTouched.length>b&&(b=A.openingsTouched.length,g=x);continue}}else{A.openingsTouched.length>b&&(b=A.openingsTouched.length,g=x);continue}}}if(g!==null){let b=f.get(g);for(let x of w){if(g===x)continue;let A=f.get(x);if(A.isUnchordedDig){if(!A.positionIfUnchordedDig)throw new Error("Unchorded dig with missing position");const m=A.positionIfUnchordedDig;r[m.x][m.y]=null,Z.deleteValueFromArray(s[m.x][m.y].floating,x),f.delete(x);const I=o[m.x][m.y];if(I.number===0){const M=I.labelIfOpening,T=u.get(M);for(let N of T.edges)Z.deleteValueFromArray(s[N.x][N.y].floating,x),C.push({x:N.x,y:N.y})}else{for(let M of I.safeNeighbours)o[M.x][M.y].number!==0&&(Z.deleteValueFromArray(s[M.x][M.y].floating,x),C.push({x:M.x,y:M.y}));for(let M of I.openingsTouched){const T=u.get(M);for(let N of T.edges)N.x===m.x&&N.y===m.y||(Z.deleteValueFromArray(s[N.x][N.y].floating,x),C.push({x:N.x,y:N.y}))}}}else{b.mergeWithPath(A.path),b.mergeWithOpeningsTouched(A.openingsTouched);for(let m of A.path){r[m.x][m.y]=g;let I=o[m.x][m.y];for(let M of I.safeNeighbours){if(o[M.x][M.y].number===0)continue;let T=s[M.x][M.y];const N=Math.max(0,T.floating.length+Math.min(1,T.fixed.length)-1);b.isFloatingSeed?(Z.deleteValueFromArray(T.floating,x),T.floating.includes(g)||T.floating.push(g)):(Z.deleteValueFromArray(T.floating,x),T.fixed.includes(g)||T.fixed.push(g));const R=Math.max(0,T.floating.length+Math.min(1,T.fixed.length)-1);N!==R&&C.push({x:M.x,y:M.y})}}for(let m of A.openingsTouched){let I=u.get(m);for(let M of I.edges){let T=s[M.x][M.y];const N=Math.max(0,T.floating.length+Math.min(1,T.fixed.length)-1);b.isFloatingSeed?(Z.deleteValueFromArray(T.floating,x),T.floating.includes(g)||T.floating.push(g)):(Z.deleteValueFromArray(T.floating,x),T.fixed.includes(g)||T.fixed.push(g));const R=Math.max(0,T.floating.length+Math.min(1,T.fixed.length)-1);N!==R&&C.push({x:M.x,y:M.y})}}if(A.path.length===1){const m=A.path[0],I=s[m.x][m.y];Z.deleteValueFromArray(I.floating,x)}f.delete(x)}}if(b.isUnchordedDig)if(b.isUnchordedDig=!1,b.addToPath(y.x,y.y),b.isFloatingSeed)b.positionIfUnchordedDig=!1;else{b.seedLocationsIfFixed=[{x:b.positionIfUnchordedDig.x,y:b.positionIfUnchordedDig.y}],b.positionIfUnchordedDig=!1,Z.deleteValueFromArray(F,g);for(let x of v.safeNeighbours){if(o[x.x][x.y].number===0)continue;let A=s[x.x][x.y];const m=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);A.fixed.includes(g)||A.fixed.push(g);const I=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);m!==I&&C.push({x:x.x,y:x.y})}for(let x of v.openingsTouched){const A=u.get(x);for(let m of A.edges)if(!(m.x===y.x&&m.y===y.y)){let I=s[m.x][m.y];const M=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);I.fixed.includes(g)||I.fixed.push(g);const T=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);M!==T&&C.push({x:m.x,y:m.y})}}}else{b.addToPath(y.x,y.y),r[y.x][y.y]=g;for(let x of v.safeNeighbours){if(o[x.x][x.y].number===0)continue;let A=s[x.x][x.y];const m=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);b.isFloatingSeed?A.floating.includes(g)||A.floating.push(g):A.fixed.includes(g)||A.fixed.push(g);const I=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);m!==I&&C.push({x:x.x,y:x.y})}for(let x of v.openingsTouched){if(b.openingsTouched.includes(x))continue;let A=u.get(x);for(let m of A.edges){let I=s[m.x][m.y];const M=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);b.isFloatingSeed?I.floating.includes(g)||I.floating.push(g):I.fixed.includes(g)||I.fixed.push(g);const T=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);M!==T&&C.push({x:m.x,y:m.y})}}}for(let x of v.openingsTouched)b.addOpeningTouched(x)}else{for(let x of w){let A=f.get(x);if(A.isUnchordedDig){if(!A.positionIfUnchordedDig)throw new Error("Unchorded dig with missing position");const m=A.positionIfUnchordedDig;r[m.x][m.y]=null,Z.deleteValueFromArray(s[m.x][m.y].floating,x),f.delete(x);const I=o[m.x][m.y];if(I.number!==0){for(let M of I.safeNeighbours)o[M.x][M.y].number!==0&&(Z.deleteValueFromArray(s[M.x][M.y].floating,x),C.push({x:M.x,y:M.y}));for(let M of I.openingsTouched){const T=u.get(M);for(let N of T.edges)N.x===m.x&&N.y===m.y||(Z.deleteValueFromArray(s[N.x][N.y].floating,x),C.push({x:N.x,y:N.y}))}}else throw new Error("We don't have a baseChain, yet neighbour an unchordedDig with opening. This is impossible.")}else throw new Error("We don't have a baseChain, yet neighbour a chorded chain. This is impossible.")}r[y.x][y.y]=h.id;let b=new H;b.addToPath(y.x,y.y),f.set(h.id,b);for(let x of v.safeNeighbours){if(o[x.x][x.y].number===0)continue;let A=s[x.x][x.y];const m=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);A.floating.includes(h.id)||A.floating.push(h.id);const I=Math.max(0,A.floating.length+Math.min(1,A.fixed.length)-1);m!==I&&C.push({x:x.x,y:x.y})}for(let x of v.openingsTouched){const A=u.get(x);for(let m of A.edges)if(!(m.x===y.x&&m.y===y.y)){let I=s[m.x][m.y];const M=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);I.floating.includes(h.id)||I.floating.push(h.id);const T=Math.max(0,I.floating.length+Math.min(1,I.fixed.length)-1);M!==T&&C.push({x:m.x,y:m.y})}}for(let x of v.openingsTouched)b.addOpeningTouched(x);h.id+=1}const k=v.mineNeighbours.filter(b=>!i[b.x][b.y]);n[y.x][y.y]||(n[y.x][y.y]=!0,d++);for(let b of k)p++,i[b.x][b.y]=!0;const P=[...v.openingsTouched].map(b=>u.get(b)).filter(b=>{const x=b.zeros[0];return!n[x.x][x.y]});for(let b of P){for(let x of b.zeros)n[x.x][x.y]||(n[x.x][x.y]=!0,d++);for(let x of b.edges)n[x.x][x.y]||(n[x.x][x.y]=!0,d++),C.push({x:x.x,y:x.y})}for(let b of v.safeNeighbours)n[b.x][b.y]||(n[b.x][b.y]=!0,d++);for(let b=y.x-2;b<=y.x+2;b++)for(let x=y.y-2;x<=y.y+2;x++)C.push({x:b,y:x});C=C.filter((b,x,A)=>x===A.findIndex(m=>m.x===b.x&&m.y===b.y));for(let b of C)this.updateChainPremiumForCoord(b.x,b.y,o,i,n,l,u,r,f,s,a,c);return{newlyRevealed:d,flagsPlaced:p,onlyNFRemaining:!1}}static nfClickEverythingForChainZini(e,t,o,i,n,l){const u=t.length,r=t[0].length;for(let f=0;f<u;f++)for(let s=0;s<r;s++){const a=e[f][s];if(a.isMine||t[f][s]||!a.is3bv)continue;t[f][s]=!0,a.number!==0&&(i[f][s]=l.id);let h=new H;h.isUnchordedDig=!0,h.positionIfUnchordedDig={x:f,y:s},n.set(l.id,h),l.id+=1;const c=a.labelIfOpening;if(c!==null){const d=o.get(c);for(let p of d.zeros)t[p.x][p.y]=!0;for(let p of d.edges){t[p.x][p.y]=!0;const y=i[p.x][p.y];if(y!==null){const C=n.get(y);if(C.isFloatingSeed&&C.isUnchordedDig){if(!C.positionIfUnchordedDig)throw new Error("Unchorded dig with missing position");const v=C.positionIfUnchordedDig;i[v.x][v.y]=null,n.delete(y)}}}}}}static calcNWayChainZini({mines:e,preprocessedData:t=!1,initialRevealedStates:o=!1,initialFlagStates:i=!1,initialChainIds:n=!1,initialChainMap:l=!1,initialChainNeighbourhoodGrid:u=!1,returnAllZinis:r=!1,includeClickPath:f=!1,numberOfIterations:s}){const a=e.length,h=e[0].length;let c=Q.createBulkRandom(a,h,s,!0);return this.calcChainZini({mines:e,preprocessedData:t,initialRevealedStates:o,initialFlagStates:i,initialChainIds:n,initialChainMap:l,initialChainNeighbourhoodGrid:u,priorityGrids:c,returnAllZinis:r,includeClickPath:f})}static convertSolutionToClickPath({chainIds:e,chainMap:t,mines:o,chainSquareInfo:i,preprocessedOpenings:n}){let l=[];const u=o.length,r=o[0].length;let f=new Array(u).fill(0).map(()=>new Array(r).fill(!1)),s=new Array(u).fill(0).map(()=>new Array(r).fill(!1));for(let a of t.values()){if(a.isFloatingSeed)if(a.isUnchordedDig){if(!a.positionIfUnchordedDig)throw new Error("Unchorded dig with missing position");l.push({type:"left",x:a.positionIfUnchordedDig.x,y:a.positionIfUnchordedDig.y})}else l.push({type:"left",x:a.path[0].x,y:a.path[0].y}),s[a.path[0].x][a.path[0].y]=!0;else for(let c of a.seedLocationsIfFixed){l.push({type:"left",x:c.x,y:c.y}),s[c.x][c.y]=!0;const d=i[c.x][c.y];if(d.number===0){const p=n.get(d.labelIfOpening);for(let y of p.edges)s[y.x][y.y]=!0}}if(a.isUnchordedDig)continue;let h=[...a.path];for(;h.length!==0;){let c=h.filter(d=>s[d.x][d.y]);if(c.length===0)throw console.log(a),new Error("Bad chain - no playable chords");for(let d of c){for(let p=d.x-1;p<=d.x+1;p++)for(let y=d.y-1;y<=d.y+1;y++)p===d.x&&y===d.y||p<0||p>=u||y<0||y>=r||o[p][y]&&!f[p][y]&&(f[p][y]=!0,l.push({type:"right",x:p,y}));l.push({type:"chord",x:d.x,y:d.y});for(let p of i[d.x][d.y].safeNeighbours)s[p.x][p.y]=!0;for(let p of i[d.x][d.y].openingsTouched){const y=n.get(p);for(let C of y.edges)C.x===d.x&&C.y===d.y||(s[C.x][C.y]=!0)}}h=h.filter(d=>!c.includes(d))}}return l}static convertClickPathToChainInput(e,t,o){const i=t.length,n=t[0].length;e=e.filter(g=>!g.type.includes("wasted"));const{numbersArray:l,openingLabels:u,preprocessedOpenings:r}=z.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(t),f=this.computeChainSquareInfo(t,l,u,r);let s=new Array(i).fill(0).map(()=>new Array(n).fill(!1)),a=new Array(i).fill(0).map(()=>new Array(n).fill(!1)),h=new Array(i).fill(0).map(()=>new Array(n).fill(null)),c=new Map,d=new Array(i).fill(0).map(()=>new Array(n).fill(0).map(()=>({floating:[],fixed:[]})));e.forEach(g=>{g.type==="right"&&(a[g.x][g.y]=!0)});let p=new Set(e.filter(g=>g.type==="left")),y=new Set(e.filter(g=>g.type==="chord")),C=new Array(i).fill(0).map(()=>new Array(n).fill(0).map(()=>({left:null,chord:null})));for(let g of p)C[g.x][g.y].left=g;for(let g of y)C[g.x][g.y].chord=g;let v=[],O=[],w=0;for(;p.size!==0;){let g=p.values().next().value,k=f[g.x][g.y];p.delete(g);let P=null;if(k.number===0){let m=u[g.x][g.y],I=r.get(m);for(let M of I.edges)if(C[M.x][M.y].chord&&y.has(C[M.x][M.y].chord)){P=C[M.x][M.y].chord;break}}else C[g.x][g.y].chord&&y.has(C[g.x][g.y].chord)&&(P=C[g.x][g.y].chord);if(!P){k.number===0?O.push(g):v.push(g);continue}s[g.x][g.y]=!0;let b=new H;o?b.isFloatingSeed=!0:b.isFloatingSeed=!1;let x=[];o||x.some(m=>m.x===g.x&&m.y===g.y)||x.push({x:g.x,y:g.y});let A=[P];for(;A.length!==0;){let m=A.shift(),I=f[m.x][m.y];y.delete(m),b.addToPath(m.x,m.y),h[m.x][m.y]=w;let M=[];for(let T of I.openingsTouched){if(b.openingsTouched.includes(T))continue;b.addOpeningTouched(T);const N=r.get(T);for(let R of N.zeros){s[R.x][R.y]=!0;let B=C[R.x][R.y].left;o?B&&p.delete(B):B&&(p.delete(B),x.some(U=>U.x===B.x&&U.y===B.y)||x.push({x:B.x,y:B.y}))}for(let R of N.edges)M.push(R)}for(let T of I.safeNeighbours)l[T.x][T.y]!==0&&M.push(T);for(let T of M){s[T.x][T.y]=!0;let N=d[T.x][T.y];o?N.floating.includes(w)||N.floating.push(w):N.fixed.includes(w)||N.fixed.push(w);let R=C[T.x][T.y].left,B=C[T.x][T.y].chord;o?(R&&p.delete(R),B&&y.has(B)&&(A.push(B),y.delete(B))):(B&&!R&&y.has(B)&&(A.push(B),y.delete(B)),B&&R&&(p.delete(R),x.some(U=>U.x===R.x&&U.y===R.y)||x.push({x:R.x,y:R.y}),y.has(B)&&(A.push(B),y.delete(B))),!B&&R&&p.has(R)&&(v.push(R),p.delete(R)))}}o||(b.seedLocationsIfFixed=x),c.set(w,b),w++}let F=[...O,...v];for(let g of F){if(o&&s[g.x][g.y])continue;if(s[g.x][g.y]=!0,l[g.x][g.y]===0){let P=u[g.x][g.y],b=r.get(P);for(let x of b.zeros)s[x.x][x.y]=!0;for(let x of b.edges)s[x.x][x.y]=!0}l[g.x][g.y]!==0&&(h[g.x][g.y]=w);let k=new H;if(o?k.isFloatingSeed=!0:k.isFloatingSeed=!1,k.isUnchordedDig=!0,k.positionIfUnchordedDig={x:g.x,y:g.y},o||(k.seedLocationsIfFixed=[{x:g.x,y:g.y}]),c.set(w,k),o){const P=f[g.x][g.y];for(let b of P.openingsTouched){let x=r.get(b);for(let A of x.edges){const m=d[A.x][A.y];m.floating.includes(w)||m.floating.push(w)}}for(let b of P.safeNeighbours)if(l[b.x][b.y]!==0){const x=d[b.x][b.y];x.floating.includes(w)||x.floating.push(w)}if(l[g.x][g.y]===0){let b=u[g.x][g.y],x=r.get(b);for(let A of x.edges){const m=d[A.x][A.y];m.floating.includes(w)||m.floating.push(w)}}if(l[g.x][g.y]!==0){const b=d[g.x][g.y];b.floating.includes(w)||b.floating.push(w)}}else if(l[g.x][g.y]!==0){const P=d[g.x][g.y];P.fixed.includes(w)||P.fixed.push(w)}else{let P=u[g.x][g.y],b=r.get(P);for(let x of b.edges){const A=d[x.x][x.y];A.fixed.includes(w)||A.fixed.push(w)}}w++}return{initialRevealedStates:s,initialFlagStates:a,initialChainIds:h,initialChainMap:c,initialChainNeighbourhoodGrid:d}}static calcInclusionExclusionZini({mines:e,preprocessedData:t=!1,initialRevealedStates:o=!1,initialFlagStates:i=!1,initialChainIds:n=!1,initialChainMap:l=!1,initialChainNeighbourhoodGrid:u=!1,initialChainPremiums:r=!1,chainSquareInfo:f=!1,doTimingRun:s=!1,analysisType:a="average",deepIterations:h=50,forbidMoves:c=!1,progressUpdateFunction:d=!1,progressType:p=null,percentageSegment:y={start:0,scale:100},priorityGrids:C=!1}){const v=e.length,O=e[0].length;let w;s&&(w=performance.now()),t=this.getPreprocessedDataIfFalse(t,e);const{numbersArray:F,openingLabels:g,preprocessedOpenings:k}=t;let P=this.getBlankRevealedStatesIfFalse(o,v,O,!0),{flagStates:b,flagsPlacedBefore:x}=this.getBlankFlagStatesIfFalse(i,v,O,!0),A=this.getBlankChainIdsIfFalse(n,v,O,!0),{chainMap:m,nextChainId:I}=this.getBlankChainMapIfFalse(l,!0);const M={id:I};let T=this.getBlankChainNeighbourhoodGridIfFalse(u,v,O,!0);f=this.computeChainSquareInfoIfFalse(f,e,F,g,k);let N=this.getChainPremiumsIfFalse(r,e,f,b,P,k,A,m,T,v,O,!1,!0),R=0;for(let W=0;W<v;W++)for(let j=0;j<O;j++)!e[W][j]&&!P[W][j]&&R++;const B=R;let U=null;const J=s?1:h;C||(C=Q.createBulkRandom(v,O,J,!0));let V=new Array(v).fill(0).map(()=>new Array(O).fill(!1));for(;;){let j=this.calcChainZini({mines:e,preprocessedData:t,initialRevealedStates:P,initialFlagStates:b,initialChainIds:A,initialChainMap:m,initialChainNeighbourhoodGrid:T,chainSquareInfo:f,initialChainPremiums:N,priorityGrids:C,returnAllZinis:!0,forbiddenGrid:V}).allZinis,ee=this.getConsiderableChords({mines:e,initialRevealedStates:P,chainSquareInfo:f,initialChainPremiums:N,forbiddenGrid:V});if(ee.length===0)break;let q=[];for(let E of ee){const X={x:E.x,y:E.y},D=z.fast2dArrayCopy(A),$=this.cloneChainMap(m),_=this.cloneChainNeighbourhoodGrid(T),ge=z.fast2dArrayCopy(b),pe=z.fast2dArrayCopy(P),ye=z.fast2dArrayCopy(N),Se={id:M.id};this.doChainChord(E.x,E.y,f,ge,pe,ye,k,D,$,_,!1,Se,V);let Re=this.calcChainZini({mines:e,preprocessedData:t,initialRevealedStates:pe,initialFlagStates:ge,initialChainIds:D,initialChainMap:$,initialChainNeighbourhoodGrid:_,chainSquareInfo:f,initialChainPremiums:ye,priorityGrids:C,returnAllZinis:!0,forbiddenGrid:V});X.zinisForced=Re.allZinis,q.push(X)}let L;if(s)L=this.analyseResultsTimingRun(j,q);else if(a==="minimum")L=this.analyseResultsMinimum(j,q);else if(a==="average")L=this.analyseResultsAverage(j,q);else if(a==="average then minimum")L=this.analyseResultsAverageThenMinimum(j,q);else throw new Error("Unrecognised analysis type");for(let E of L.toForbid)V[E.x][E.y]=!0,N[E.x][E.y]=-100;for(let E of L.toDo)this.doChainChord(E.x,E.y,f,b,P,N,k,A,m,T,!1,M,V);if(d){if(p==="visual"){const E=this.convertSolutionToClickPath({chainIds:A,chainMap:m,mines:e,chainSquareInfo:f,preprocessedOpenings:k});d("board-progress",E)}else if(p==="text"){let E=0;for(let $=0;$<v;$++)for(let _=0;_<O;_++)!P[$][_]&&!e[$][_]&&E++;const X=(B-E)/B,D=Math.floor(y.start+X*y.scale);D!==U&&(U=D,d("percentage-progress",D))}}if(L.toForbid.length===0&&L.toDo.length===0)break}let G=this.calcChainZini({mines:e,preprocessedData:t,initialRevealedStates:P,initialFlagStates:b,initialChainIds:A,initialChainMap:m,initialChainNeighbourhoodGrid:T,chainSquareInfo:f,initialChainPremiums:N,priorityGrids:C,returnAllZinis:!0,includeClickPath:!0,forbiddenGrid:V});if(s){const j=(performance.now()-w)/1e3*h*5;G.expectedTimeForRealRun=j}return G}static getConsiderableChords({mines:e,initialRevealedStates:t,chainSquareInfo:o,initialChainPremiums:i,forbiddenGrid:n}){const l=e.length,u=e[0].length;let r=[];for(let f=0;f<l;f++)for(let s=0;s<u;s++){if(e[f][s])continue;const a=o[f][s];if(a.number===0||n[f][s])continue;let h=!1;for(let c of a.safeNeighbours)t[c.x][c.y]||(h=!0);!h&&i[f][s]<0||r.push({x:f,y:s})}return r}static getConsiderableChordsImproved({mines:e,initialRevealedStates:t,chainSquareInfo:o,initialChainPremiums:i,forbiddenGrid:n}){const l=e.length,u=e[0].length;let r=[];for(let f=0;f<l;f++)for(let s=0;s<u;s++){if(e[f][s])continue;const a=o[f][s];if(a.number===0||n[f][s])continue;let h=!1;for(let c of a.safeNeighbours)t[c.x][c.y]||(h=!0);if(!(!h&&i[f][s]<=0)){if(a.nonOpening3bvNeighbours.length===0&&a.openingsTouched.size===1){let c=a.openingsTouched.values().next().value,d=!1;for(let p of a.safeNeighbours)if(!o[p.x][p.y].openingsTouched.has(c)){d=!0;break}if(!d)continue}throw new Error("TODO - Filter out chords that are equivalent to clicking an opening")}}return r}static analyseResultsMinimum(e,t){let o=e.reduce((u,r)=>Math.min(u,r),1/0),i=null,n=1/0,l=1/0;for(let u of t){let r=u.zinisForced.reduce((s,a)=>Math.min(s,a),1/0),f=u.zinisForced.reduce((s,a)=>s+a)/u.zinisForced.length;if(r===n&&f<l){n=r,l=f,i={x:u.x,y:u.y};continue}r<n&&(n=r,l=f,i={x:u.x,y:u.y})}return o<n||i===null?{toDo:[],toForbid:[]}:{toDo:[i],toForbid:[]}}static analyseResultsAverageOld2(e,t){let o=e.reduce((r,f)=>r+f)/e.length,i=null,n=-1/0,l=1/0,u=[];for(let r of t){let f=r.zinisForced.reduce((h,c)=>h+c)/r.zinisForced.length,a=r.zinisExcluded.reduce((h,c)=>h+c)/r.zinisExcluded.length-f;a>n&&(n=a,l=f,i={x:r.x,y:r.y})}return o<l||i===null?{toDo:[],toForbid:u}:{toDo:[i],toForbid:u}}static analyseResultsAverageOld(e,t){let o=e.reduce((l,u)=>l+u)/e.length,i=null,n=1/0;for(let l of t){let u=l.zinisForced.reduce((r,f)=>r+f)/l.zinisForced.length;u<n&&(n=u,i={x:l.x,y:l.y})}return o<n||i===null?{toDo:[],toForbid:[]}:{toDo:[i],toForbid:[]}}static analyseResultsAverage(e,t){e.reduce((s,a)=>s+a)/e.length;let o=e.reduce((s,a)=>Math.min(s,a),1/0),i=[];for(let s=0;s<t.length;s++){const a={index:s,minimum:t[s].zinisForced.reduce((h,c)=>Math.min(h,c),1/0),average:t[s].zinisForced.reduce((h,c)=>h+c)/t[s].zinisForced.length};i.push(a)}let n=i.reduce((s,a)=>Math.min(s,a.average),1/0),l=i.filter(s=>s.average<n+.1);l=l.sort((s,a)=>s.average-a.average);let u=l[0].index,r=l[0].minimum;for(let s of l)s.minimum<r&&(u=s.index,r=s.minimum);let f=t[u];return o<r?{toDo:[],toForbid:[]}:{toDo:[{x:f.x,y:f.y}],toForbid:[]}}static analyseResultsAverageThenMinimum(e,t){let i=e.reduce((s,a)=>s+a)/e.length,n=e.reduce((s,a)=>Math.min(s,a),1/0),l=null,u=!1,r=1/0,f=1/0;for(let s of t){let a=s.zinisForced.reduce((c,d)=>c+d)/s.zinisForced.length,h=s.zinisForced.reduce((c,d)=>Math.min(c,d),1/0);a<i-.5?(u=!0,a<r&&(r=a,l={x:s.x,y:s.y},f=h)):u||h<f&&(f=h,l={x:s.x,y:s.y})}return l===null||!u&&n<f?{toDo:[],toForbid:[]}:{toDo:[l],toForbid:[]}}static calcNWayInclusionExclusionZini({mines:e,preprocessedData:t=!1,initialRevealedStates:o=!1,initialFlagStates:i=!1,initialChainIds:n=!1,initialChainMap:l=!1,initialChainNeighbourhoodGrid:u=!1,initialChainPremiums:r=!1,chainSquareInfo:f=!1,deepIterations:s=50,forbidMoves:a=!1,progressUpdateFunction:h=!1,progressType:c=null}){const d=e.length,p=e[0].length;let y=Q.createBulkRandom(d,p,s,!0);t=this.getPreprocessedDataIfFalse(t,e);const{numbersArray:C,openingLabels:v,preprocessedOpenings:O}=t;f=this.computeChainSquareInfoIfFalse(f,e,C,v,O);let w=this.getBlankRevealedStatesIfFalse(o,d,p,!0),{flagStates:F,flagsPlacedBefore:g}=this.getBlankFlagStatesIfFalse(i,d,p,!0),k=this.getBlankChainIdsIfFalse(n,d,p,!0),{chainMap:P,nextChainId:b}=this.getBlankChainMapIfFalse(l,!0),x=this.getBlankChainNeighbourhoodGridIfFalse(u,d,p,!0),A=this.getChainPremiumsIfFalse(r,e,f,F,w,O,k,P,x,d,p,!1,!0);h&&h("iteration-update",`0/${s}`);let m=1/0,I=null;for(let M=0;M<s;M++){let T=[y[M]];const N=z.fast2dArrayCopy(k),R=this.cloneChainMap(P),B=this.cloneChainNeighbourhoodGrid(x),U=z.fast2dArrayCopy(F),J=z.fast2dArrayCopy(w),V=z.fast2dArrayCopy(A);let G=this.calcInclusionExclusionZini({mines:e,preprocessedData:t,initialRevealedStates:J,initialFlagStates:U,initialChainIds:N,initialChainMap:R,initialChainNeighbourhoodGrid:B,initialChainPremiums:V,chainSquareInfo:f,doTimingRun:!1,analysisType:"minimum",deepIterations:1,forbidMoves:a,progressUpdateFunction:h,progressType:c,percentageSegment:{start:100*M/s,scale:100/s},priorityGrids:T});if(h){if(c==="visual"){const W=this.convertSolutionToClickPath({chainIds:N,chainMap:R,mines:e,chainSquareInfo:f,preprocessedOpenings:O});h("board-progress",W)}else c==="text"&&h("percentage-progress",Math.floor((M+1)/s*100));h("iteration-update",`${M+1}/${s}`),h("log-update",`${M+1}: ${G.total}`)}G.total<m&&(m=G.total,I=G)}return I}static analyseResultsTimingRun(e,t){let o=e.reduce((n,l)=>Math.min(n,l),1/0),i=[];for(let n of t){let l=n.zinisForced.reduce((u,r)=>Math.min(u,r),1/0);l<=o&&i.push({x:n.x,y:n.y,result:l})}return i.length===0?{toDo:[],toForbid:[]}:(i.sort((l,u)=>l.result-u.result),i.length>5&&(i.length=5),{toDo:i.map(l=>({x:l.x,y:l.y})),toForbid:[]})}static cloneChainMap(e){let t=new Map;for(const[o,i]of e)t.set(o,i.cloneChain());return t}static cloneChainNeighbourhoodGrid(e){return e.map(t=>t.map(o=>({floating:o.floating.slice(),fixed:o.fixed.slice()})))}static checkChainStuffConsistent(e,t,o,i,n,l,u,r,f){const s=o.length,a=o[0].length;for(let h=0;h<s;h++)for(let c=0;c<a;c++){if(e[h][c].isMine)continue;if(e[h][c].number===0&&(r[h][c].floating.length!==0||r[h][c].fixed.length!==0))throw new Error("chainNeighbourHoodGrid entry of zero tile");if(l[h][c]!==null&&!u.has(l[h][c]))throw new Error("chainId without map entry");for(let y of r[h][c].floating)if(!u.has(y))throw new Error("chainNeighbourhoodGrid floating id without map entry");for(let y of r[h][c].fixed)if(!u.has(y))throw new Error("chainNeighbourhoodGrid floating id without map entry");const d=i[h][c];this.updateChainPremiumForCoord(h,c,e,t,o,i,n,l,u,r,f);const p=i[h][c];if(d!==p)throw new Error("Premium that didnt get updated")}}static getPreprocessedDataIfFalse(e,t){return e||z.getNumbersArrayAndOpeningLabelsAndPreprocessedOpenings(t)}static getBlankRevealedStatesIfFalse(e,t,o,i=!1){return e?i?z.fast2dArrayCopy(e):e:new Array(t).fill(0).map(()=>new Array(o).fill(!1))}static getBlankFlagStatesIfFalse(e,t,o,i=!1){let n=0,l;if(e){i?l=z.fast2dArrayCopy(e):l=e;for(let u=0;u<t;u++)for(let r=0;r<o;r++)e[u][r]&&n++}else l=new Array(t).fill(0).map(()=>new Array(o).fill(!1));return{flagStates:l,flagsPlacedBefore:n}}static getBlankChainIdsIfFalse(e,t,o,i=!1){return e?i?z.fast2dArrayCopy(e):e:new Array(t).fill(0).map(()=>new Array(o).fill(null))}static getBlankChainMapIfFalse(e,t=!1){let o,i;return e?(t?o=this.cloneChainMap(e):o=e,i=Math.max(0,Math.max(0,...e.keys()))+1):(o=new Map,i=0),{chainMap:o,nextChainId:i}}static getBlankChainNeighbourhoodGridIfFalse(e,t,o,i=!1){return e?i?this.cloneChainNeighbourhoodGrid(e):e:new Array(t).fill(0).map(()=>new Array(o).fill(0).map(()=>({floating:[],fixed:[]})))}static computeChainSquareInfoIfFalse(e,t,o,i,n){return e||this.computeChainSquareInfo(t,o,i,n)}static getChainPremiumsIfFalse(e,t,o,i,n,l,u,r,f,s,a,h=!1,c=!1){if(e)return c?z.fast2dArrayCopy(e):e;const d=new Array(s).fill(0).map(()=>new Array(a).fill(null));for(let p=0;p<s;p++)for(let y=0;y<a;y++)t[p][y]||this.updateChainPremiumForCoord(p,y,o,i,n,d,l,u,r,f,!1,h);return d}}class Q{constructor(){throw new Error("PriorityGridCreator class only has static methods, and cannot be instantiated")}static createBasic(e,t){let o=[];for(let i=0;i<e;i++){o[i]=[];for(let n=0;n<t;n++)o[i][n]=e*t-(n*e+i)}return o}static createRandom(e,t,o=!1){let i=new Array(e*t).fill(0).map((u,r)=>r+1);z.fisherYatesArrayShuffle(i,o);const n=new Array(e).fill(0).map(()=>new Array(t).fill(!1));let l=0;for(let u=0;u<e;u++)for(let r=0;r<t;r++)n[u][r]=i[l],l++;return n}static createBulkRandom(e,t,o,i){let n=!1;i&&(n=Te(o));let l=[];for(let u=0;u<o;u++)l[u]=Q.createRandom(e,t,n);return l}}onmessage=function(S){ke(S.data.parameters),S.data.parameters.analysisType==="separate"?Ne(S.data.parameters,S.data.deepReportProgress):Pe(S.data.parameters,S.data.deepReportProgress)};function Pe(S,e){let t={...S,doTimingRun:!0},o=te.calcInclusionExclusionZini(t);he(o.expectedTimeForRealRun);let i={...S,progressUpdateFunction:e?ce:!1},n=te.calcInclusionExclusionZini(i);de(n)}function Ne(S,e){let t={...S,doTimingRun:!0},o=te.calcInclusionExclusionZini(t);he(o.expectedTimeForRealRun);let i={...S,progressUpdateFunction:e?ce:!1},n=te.calcNWayInclusionExclusionZini(i);de(n)}function he(S){postMessage({type:"timing-run-done",timingRun:S})}function ce(S,e){switch(S){case"board-progress":postMessage({type:"board-progress",clicks:e});break;case"percentage-progress":postMessage({type:"percentage-progress",percentage:e});break;case"iteration-update":postMessage({type:"iteration-update",iterations:e});break;case"log-update":postMessage({type:"log-update",logEntry:e});break;default:throw new Error("Unrecognised update type: "+S)}}function de(S){postMessage({type:"run-complete",result:S})}function ke(S){if(S.initialChainMap)for(let e of S.initialChainMap.values())Object.setPrototypeOf(e,H.prototype)}})();
